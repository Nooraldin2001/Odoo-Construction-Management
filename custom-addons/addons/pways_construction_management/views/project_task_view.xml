<odoo>

    <!-- Kanban -->
    <record id="view_task_kanban_construct" model="ir.ui.view">
        <field name="name">project.task.view.kanban.construct</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_kanban"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='tag_ids']" position='after'>
                <field name="stage_is_progress" invisible="1"/>
                <field name="progress_bar" class="d-flex align-items-center ps-0 ps-lg-5" widget="progressbar" attrs="{'invisible': [('stage_is_progress', '=', False)]}"/>
            </xpath>
        </field>
    </record>

    <!-- Tree -->
    <record id="view_task_tree2_construct" model="ir.ui.view">
        <field name="name">project.task.view.tree.construct</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_tree2"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='user_ids']" position='after'>
                <field name="stage_is_progress" invisible="1"/>
                <field name="progress_bar" widget="progressbar" attrs="{'invisible': [('stage_is_progress', '=', False)]}"/>
            </xpath>
        </field>
    </record>

    <!-- form -->
    <record id="job_cost_task_form_view" model="ir.ui.view">
        <field name="name">project.task.inherited.form</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_form2"/>
        <field name="arch" type="xml">
            <xpath expr="//form/header/field[@name='stage_id']" position="before">
                <button string="Create Subtasks" type="action" name="%(pways_construction_management.action_proejct_subtask_user_wizard)d" class="oe_highlight" groups="project.group_project_manager" />
                <!-- <button string="Equipment Bill" type="object" name="action_create_bill" class="oe_highlight"/> -->
                <button string="Create Picking" type="object" name="btn_out_pick_consume_prod" class="oe_highlight"/>
            </xpath>

            <field name="project_id" position="after">
                 <field name="parent_task_id" invisible="1"/>
            </field>
            <field name="tag_ids" position="after">
                <field name="job_cost_id" domain="[('project_id', '=', project_id)]"/>
            </field>

            <xpath expr="//form/sheet/notebook/page[@name='description_page']" position="after">
                <page string="Material Plannings" name="job_cost_task_material">
                    <field name="material_plan_ids" nolabel="1">
                        <tree editable="bottom">
                            <field name="product_id"/>
                            <field name="description"/>
                            <field name="product_uom_qty"/>
                            <field name="product_uom"/>
                        </tree>
                    </field>
                </page>
                <page string="Consumed Materials" name="job_cost_task_consume_material">
                    <field name="consumed_material_ids" nolabel="1">
                        <tree editable="bottom">
                            <field name="product_id"/>
                            <field name="description"/>
                            <field name="product_uom_qty"/>
                            <field name="consumed_qty" string="Consumed Qty" readonly="1"/>
                            <field name="product_uom"/>
                            <field name="is_picked" string="Is Picked" readonly="1"/>
                        </tree>
                    </field>
                </page>
                <page string="Vehicle" name="job_cost_fleet_page">
                    <field name="req_vehcle_line_ids" nolabel="1" context="{'default_request_type':'vehicle'}">
                        <tree editable="bottom">
                            <field name="name"/>
                            <field name="description"/>
                            <field name="hours"/>
                            <field name="request_type" invisible="1"/>
                            <field name="fleet_ids" widget="many2many_tags"/>
                        </tree>                            
                    </field>
                </page>
                <page string="Equipment" name="job_cost_eqquipmemt_page">
                    <field name="req_equipment_line_ids" nolabel="1" context="{'default_request_type':'equipment'}">
                        <tree editable="bottom">
                            <field name="name"/>
                            <field name="description"/>
                            <field name="hours"/>
                            <field name="request_type" invisible="1"/>
                            <field name="equipment_ids" widget="many2many_tags"/>
                        </tree>                            
                    </field>
                </page>
                <page name="expense" string="Expense" >
                    <field name="expense_ids">
                        <tree editable="bottom">
                            <field name="product_id"/>
                            <field name="name" required="1"/>
                            <field name="total_amount"/>
                            <field name="currency_id"/>
                            <field name="date"/>
                            <field name="payment_mode"/>
                            <field name="employee_id"/>
                            <field name="company_id"/>
                            <field name="account_id"/>
                            <field name="analytic_distribution" widget="analytic_distribution"/>
                            <field name="project_id"/>
                            <field name="task_id"/>
                            <field name="job_cost_id"/>
                            <field name="state" invisible="1"/>
                        </tree>
                    </field>
                </page>
                <page name="instruct_qlty_ids" string="Instruction and Quality Checklist">
                    <field name="instruct_qlty_ids">
                        <tree editable="bottom">
                            <field name="card_instruction_type"/>
                            <field name="name"/>
                            <field name="code"/>
                        </tree>
                    </field>
                </page>
            </xpath>

            <field name="user_ids" position="after">
                <!-- <field name="date_start"/> -->
                <field name="date_end"/>
                <field name="job_number" readonly="1"/>
            </field>

            <xpath expr="//form/sheet/div[@name='button_box']" position="inside">
                <button class="oe_stat_button" string="Stock Moves" name="view_stock_moves" type="object" icon="fa-navicon">
                    <field name="stock_moves_count" widget="statinfo"/>
                </button>
                <button class="oe_stat_button" type="object" icon="fa-truck" name="open_picking_action">
                    <field string="Delivery" name="picking_count" widget="statinfo" />
                </button>
                <button class="oe_stat_button" type="object" icon="fa-tasks" name="view_notes">
                    <field string="Notes" name="notes_count" widget="statinfo" />
                </button>
            
                <button name="all_bills_action" type="object" class="oe_stat_button" icon="fa-pencil-square-o">
                    <field string="All Bills" name="all_bills_count" widget="statinfo"/>
                </button>
                <button name="material_reqsn_action" type="object" class="oe_stat_button">
                    <field string="Material Requisitions" name="material_reqsn_count" widget="statinfo"/>
                </button>
                <button name="stock_view_action" type="object" class="oe_stat_button" icon="fa-cubes">
                    <field string="On Hand Quantity" name="stock_count" widget="statinfo"/>
                </button>
            </xpath>
        </field>
    </record>


    <record id="job_cost_task_probc_custom_form_view" model="ir.ui.view">
        <field name="name">project.task.inherited.forms</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="hr_timesheet.view_task_form2_inherited"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='timesheet_ids']" position="attributes">
                <attribute name="context">{'default_is_from_task':'True', 'default_job_cost_id': job_cost_id}</attribute>
            </xpath>
            <xpath expr="//field[@name='timesheet_ids']//tree" position="inside">
                <field name="job_cost_id" options="{'no_create': True, 'no_open': True}" domain="[]" invisible="0"/>
                <field name="job_cost_line_id" domain="[]" invisible="1"/>
                <field name="is_from_task" invisible="1"/>
            </xpath>
        </field>
    </record>

    <record id="action_view_task_subtask" model="ir.actions.act_window">
        <field name="name">Tasks</field>
        <field name="res_model">project.task</field>
        <field name="view_mode">kanban,tree,form,calendar,pivot,graph</field>
        <field name="search_view_id" ref="project.view_task_search_form"/>
        <field name="help" type="html">
            <p>
                Odoo's project management allows you to manage the pipeline of your tasks efficiently. You can track progress, discuss on tasks, attach documents, etc.
            </p>
        </field>
    </record>
    
    <record id="open_view_task_list_kanban_subtask" model="ir.actions.act_window.view">
        <field name="sequence" eval="0"/>
        <field name="view_mode">kanban</field>
        <field name="act_window_id" ref="action_view_task_subtask"/>
    </record>
    
    <record id="open_view_task_list_tree_subtask" model="ir.actions.act_window.view">
        <field name="sequence" eval="1"/>
        <field name="view_mode">tree</field>
        <field name="act_window_id" ref="action_view_task_subtask"/>
    </record>
    
    <record model="ir.ui.view" id="view_task_search_form_inherit_parenttask">
        <field name="name">project.task.view</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_search_form"/>
        <field name="arch" type="xml">
            <xpath expr="//search" position="inside">
                 <field name="parent_task_id"/>
             </xpath>
             <xpath expr="//search/group" position="inside">
                 <filter string="Parent Task" name="parent_task" context="{'group_by':'parent_task_id'}"/>
             </xpath>
        </field>
    </record>

</odoo>