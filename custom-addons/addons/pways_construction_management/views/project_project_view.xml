<?xml version="1.0"?>
<odoo>
    <!-- tree -->

    <record id="view_project_tree_construct" model="ir.ui.view">
        <field name="name">project.project.view.tree.construct</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="project.view_project"/>
        <field name="arch" type="xml">
            <field name="partner_id" position="after">
                <field name="is_progress_bar"/>
                <field name="progressbar" class="d-flex align-items-center ps-0 ps-lg-5" widget="progressbar" attrs="{'invisible': [('is_progress_bar', '=', False)]}"/>
            </field>
        </field>
    </record>

    <!-- kanban -->

    <record id="view_project_kanban_construct" model="ir.ui.view">
        <field name="name">project.project.view.kanban.construct</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="project.view_project_kanban"/>
        <field name="priority">24</field>
        <field name="arch" type="xml">
            <field name="tag_ids" position="after">
                <field name="is_progress_bar" invisible="1"/>
                <field name="progressbar" widget="progressbar" attrs="{'invisible': [('is_progress_bar', '=', False)]}"/>
            </field>
            <xpath expr="//div[@t-if='record.date.raw_value or record.date_start.raw_value']" position="after">
                <field name="progressbar" lass="d-flex align-items-center ps-0 ps-lg-5" widget="progressbar" attrs="{'invisible': [('is_progress_bar', '=', False)]}"/>
            </xpath>
        </field>
    </record>

    <!-- Form -->

    <record id="project_invoice_form_inherit" model="ir.ui.view">
        <field name="name">project.project.form.inherit</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="hr_timesheet.project_invoice_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='allocated_hours']" position="after">
                <field string="Warehouse" name="warehouse_id"/>
                <field string="Job Cost" name="job_cost_id"/>
            </xpath>
        </field>
    </record>

    <record id="view_project_form_inherit" model="ir.ui.view">
        <field name="name">project.project.form.inherit</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="project.edit_project"/>
        <field name="arch" type="xml">
            <xpath expr="//header" position="replace">
                <header>
                     <button name="action_draft" string="Draft" states="cancel" type="object" class="oe_highlight"/>
                    <button name="action_confirm" string="Confirm" states="draft" type="object" class="oe_highlight"/>
                    <button name="action_in_approve" string="Approve" states="confirm" type="object" class="oe_highlight"/>
                    <button name="action_govt_approve" string="Govt. Approve" states="in_approve" type="object" class="oe_highlight"/>
                    <button name="action_in_progress" string="In Progress" states="govt_approve" type="object" class="oe_highlight"/>
                    <button name="action_ready_to_possession" string="Ready To Possession" states="in_progress" type="object" class="oe_highlight"/>
                    <button name="action_read_to_move" string="Ready To Move" states="ready_to_possession" type="object" class="oe_highlight"/>
                    <button name="action_create_tasks" string="Create Job Orders" states="confirm" type="object" class="btn-primary"/>
                    <button name="action_construct_in_picking" string="Create In-Pickng" states="ready_to_possession" type="object" class="oe_highlight"/>
                    <button name="action_send_by_mail" string="Send By Mail" states="confirm" type="object" class="oe_highlight"/>
                    <button name="action_cancel" string="Cancel" states="draft,confirm,in_approve,govt_approve" type="object" class="oe_highlight"/>
                    <field name="state" widget="statusbar" readonly="0" options="{'fold_field': 'fold'}"/>
                    <field name="stage_id" widget="statusbar" options="{'clickable': '1', 'fold_field': 'fold'}" groups="project.group_project_stages"/>
                </header>
            </xpath>
            <xpath expr="//group/field[@name='company_id']" position="after">
                <field name="construct_cycle_id"/>
            </xpath>
            <field name="tag_ids" position="after">
                <field name="is_progress_bar"/>
                <field name="progressbar" class="d-flex align-items-center ps-0 ps-lg-5" widget="progressbar" attrs="{'invisible': [('is_progress_bar', '=', False)]}"/>
            </field>
            
            <xpath expr="//div[@name='button_box']" position="inside">
                <button class="oe_stat_button" type="object" name="action_view_tasks" icon="fa-tasks">
                    <field string="Job Orders" name="task_count" widget="statinfo"/>
                </button>
                <button class="oe_stat_button" type="object" icon="fa-sticky-note-o" name="view_notes">
                    <field string="Notes" name="notes_count" widget="statinfo"/>
                </button>
                <button name="project_to_jobcost_action" type="object" class="oe_stat_button" icon="fa-book">
                    <field string="Job Costs" name="job_cost_count" widget="statinfo"/>
                </button>
                <button name="material_reqsn_action" type="object" class="oe_stat_button">
                    <field string="Material Requisitions" name="material_reqsn_count" widget="statinfo"/>
                </button>
                <button name="all_bills_action" type="object" class="oe_stat_button" icon="fa-pencil-square-o">
                    <field string="All Bills" name="all_bills_count" widget="statinfo"/>
                </button>
                <button name="maintenance_req_action" type="object" class="oe_stat_button">
                    <field string="Maintenance" name="maintenance_req_count" widget="statinfo"/>
                </button>
                <button class="oe_stat_button" type="object" icon="fa-truck" name="open_in_picking_action">
                    <field string="In-Pickngs" name="in_picking_count" widget="statinfo" />
                </button>
            </xpath>
            <xpath expr="//notebook/page[@name='description']" position="after">
                <page string="Stack Holder">
                    <field name="stack_holder_ids">
                        <kanban class="o_kanban_mobile">
                            <field name="id"/>
                            <field name="name"/>
                            <field name="email"/>
                            <field name="phone"/>                            
                            <templates>
                                <t t-name="kanban-box">
                                    <div t-attf-class="oe_kanban_global_click">
                                        <div class="o_kanban_image">
                                            <img alt="Avatar" t-att-src="kanban_image('res.users', 'avatar_128', record.id.raw_value)"/>
                                        </div>
                                        <div class="oe_kanban_details">
                                            <ul>
                                                <li class="mb4">
                                                    <strong><field name="name"/></strong>
                                                </li>
                                                <li class="mb4">
                                                    <strong><field name="email"/></strong>
                                                </li>
                                                <li class="mb4">
                                                    <strong><field name="phone"/></strong>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </t>
                            </templates>
                        </kanban>
                    </field>
                </page>
                <page name="construction_sites" string="Construction">
                    <group>
                        <group>
                            <field name="type_of_construction"/>
                            <field name="email" widget="email"/>
                            <field name="phone" widget="phone"/>
                            <field name="mobile" widget="phone"/>
                        </group>
                        <group>
                            <field name="location_id" string="Address" context="{'search_default_customer':1, 'show_address': 1}" options='{"always_reload": True}'/>
                            <field name="longitude"/>
                            <field name="latitude"/>
                        </group>
                    </group>
                    <group string="Site Measurement">
                        <group>
                            <field name="site_name" string="Site Title"/>
                            <field name="site_length" string="Site Length"/>
                        </group>
                        <group>
                            <field name="site_width" string="Site Width"/>
                            <field name="site_area" string="Site Area"/>
                        </group>
                    </group>
                    <field name="project_construct_line_ids">
                        <tree editable="bottom">
                            <field name="project_id" invisible="1"/>
                            <field name="product_id"/>
                            <field name="qty"/>
                            <field name="uom_id"/>
                            <field name="pre_construct_price"/>
                            <field name="under_construct_price"/>
                            <field name="post_construct_price"/>
                        </tree>
                    </field>
                </page>
                <page name="expense" string="Expense" >
                    <field name="expense_ids">
                        <tree editable="bottom" create='false' edit='false'>
                            <field name="product_id"/>
                            <field name="name" required="0"/>
                            <field name="total_amount"/>
                            <field name="currency_id"/>
                            <field name="date"/>
                            <field name="payment_mode"/>
                            <field name="employee_id"/>
                            <field name="company_id"/>
                            <field name="account_id"/>
                            <field name="analytic_distribution" widget="analytic_distribution"/>
                            <field name="state" invisible="1"/>
                        </tree>
                    </field>
                </page>
                <page string="Documents" autofocus="autofocus" class="page-red">
                    <field name="document_ids" widget="many2many_binary" string="Documents"></field>
                </page>
                <page string="Construction Daily Logs">
                    <field name="construction_daily_logs_ids"></field>
                </page>
            </xpath>
        </field>
    </record>
</odoo>
